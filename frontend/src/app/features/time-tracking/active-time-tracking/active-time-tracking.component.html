<mat-card class="active-tracking-card">
  <mat-card-header>
    <mat-card-title>
      {{ isTracking ? 'Currently Tracking' : 'Start Tracking' }}
    </mat-card-title>
  </mat-card-header>
  
  <mat-card-content>
    <div class="active-tracking-content">
      <div class="task-selector">
        <mat-form-field appearance="fill">
          <mat-label>Select or search task</mat-label>
          <mat-select [formControl]="taskControl" class="searchable-select" #taskSelect (openedChange)="$event && onSelectOpened()">
            <mat-select-trigger>
              <span *ngIf="selectedTask">{{ selectedTask.projectName }} - {{ selectedTask.name }}</span>
            </mat-select-trigger>
            <div class="search-field">
              <mat-form-field appearance="outline" class="search-input">
                <mat-label>Search tasks...</mat-label>
                <input matInput 
                       [formControl]="searchControl" 
                       (keydown.enter)="selectHighlightedTask()" 
                       (keydown.arrowdown)="navigateTaskOptions($any($event), 'down')"
                       (keydown.arrowup)="navigateTaskOptions($any($event), 'up')"
                       (keydown)="$event.stopPropagation()">
                <mat-icon matSuffix>search</mat-icon>
              </mat-form-field>
            </div>
<mat-option *ngFor="let task of filteredTasks; let i = index" 
                        [value]="task._id" 
                        [id]="'task-option-' + i"
                        [class.highlighted]="highlightedIndex === i">
              <ng-container *ngIf="task.azureDevOps?.workItemId as workItemId">#{{ workItemId }} - </ng-container>{{ task.projectName }} - {{ task.name }}
            </mat-option>
            <mat-option *ngIf="filteredTasks.length === 0" [disabled]="true">
              <em>No task matching your search</em>
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      
      <div class="timer-display" *ngIf="isTracking">
        <div class="timer">{{ formatElapsedTime(elapsedTime) }}</div>
      </div>
    </div>
  </mat-card-content>
  
  <mat-card-actions align="end">
    <button 
      mat-raised-button 
      color="primary" 
      *ngIf="!isTracking" 
      [disabled]="!taskControl.value"
      (click)="startTracking()">
      <mat-icon>play_arrow</mat-icon>
      Start Timer
    </button>
    
    <button 
      mat-raised-button 
      color="warn" 
      *ngIf="isTracking" 
      (click)="stopTracking()">
      <mat-icon>stop</mat-icon>
      Stop
    </button>
  </mat-card-actions>
</mat-card>